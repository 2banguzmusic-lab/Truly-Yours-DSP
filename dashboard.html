<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Artist Dashboard â€” Truly Yours DSP</title>

<!-- ====== STYLES ====== -->
<style>
    body {
        background: radial-gradient(circle at 20% 20%, #290030, #000000);
        color: white;
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
    }
    .navbar {
        display: flex;
        gap: 20px;
        padding: 15px;
        background: rgba(255,255,255,0.05);
        font-weight: bold;
    }
    .navbar a {
        text-decoration: none;
        color: white;
    }
    .container {
        padding: 20px;
    }
    .section-box {
        background: rgba(255,255,255,0.08);
        padding: 15px;
        border-radius: 12px;
        margin-top: 20px;
    }
    button {
        padding: 8px 12px;
        margin-top: 5px;
        border-radius: 10px;
        border: none;
        cursor: pointer;
        background: #d500f9;
        color: white;
        font-weight: bold;
    }
    .logout-btn {
        display: inline-block;
        margin-top: 15px;
        background: rgba(255,255,255,0.1);
        padding: 10px;
        border-radius: 8px;
    }
</style>
</head>

<body>

<!-- ====== NAV ====== -->
<div class="navbar">
    <a href="index.html">HOME</a>
    <a href="upload.html">UPLOAD MORE</a>
    <a href="#" onclick="logout()">LOG OUT</a>
</div>

<!-- ====== CONTENT ====== -->
<div class="container">
    <h1>Welcome back, <span id="Artist">Artist</span> ğŸŒŠ</h1>
    <p>Your wave is growing â€” keep dropping heat.</p>

    <h2>Your Uploaded Songs ğŸ§</h2>
    <ul id="songList">Loading...</ul>

    <div class="section-box">
        <h2>Your YouTube Links</h2>
        <ul>
            <li><a href="#" style="color:#ff69ff">Example Link</a></li>
        </ul>
    </div>

    <a href="#" class="logout-btn" onclick="logout()">Log Out</a>
</div>

<!-- ====== DASHBOARD SCRIPT WITH STATS ====== -->
<script type="module">

/*** ğŸ”¥ Firebase Imports (v10) ***/
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";
import { getStorage, ref, listAll, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-storage.js";
import { getFirestore, doc, setDoc, getDoc, updateDoc, increment } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-firestore.js";

/*** ğŸ”¥ Firebase Config ***/
const firebaseConfig = {
  apiKey: "AIzaSyB9Wc9me_xmVEorMVSPMhTD9Lq7P6zjJA",
  authDomain: "truly-yours-dsp-2025.firebaseapp.com",
  projectId: "truly-yours-dsp-2025",
  storageBucket: "truly-yours-dsp-2025.appspot.com",
  messagingSenderId: "369021879682",
  appId: "1:369021879682:web:ded7b7e150ab8fbb3cbb9b"
};

/*** ğŸ”¥ Init Firebase ***/
const app = initializeApp(firebaseConfig);
const storage = getStorage(app);
const db = getFirestore(app);

/*** ELEMENTS ***/
const songList = document.getElementById("songList");
document.getElementById("Artist").innerText = "Artist";

/*** ğŸ§ LOAD SONGS FROM STORAGE ROOT ***/
async function loadSongs() {
    songList.innerHTML = "Loadingâ€¦ ğŸ”„";

    const folder = ref(storage, "/"); // <--- ROOT WHERE YOUR FILES ARE
    const files = await listAll(folder);

    if (!files.items.length) {
        songList.innerHTML = "<li>No songs uploaded yet ğŸ¤ğŸ”¥</li>";
        return;
    }

    songList.innerHTML = "";
    for (const fileRef of files.items) {
        const url = await getDownloadURL(fileRef);
        const fileName = fileRef.name.replace(/^\d+-/, "");

        // stats doc
        const statDoc = doc(db, "stats", fileRef.name);
        let stats = await getDoc(statDoc);

        if (!stats.exists()) {
            await setDoc(statDoc, { plays: 0, views: 0 });
            stats = await getDoc(statDoc);
        }

        const { plays, views } = stats.data();

        const li = document.createElement("li");
        li.innerHTML = `
            ğŸµ <strong>${fileName}</strong><br>
            â–¶ï¸ Plays: ${plays} &nbsp; ğŸ‘ Views: ${views}<br>
            <button onclick="playSong('${fileRef.name}', '${url}')">PLAY</button>
        `;
        songList.appendChild(li);
    }
}

/*** â–¶ï¸ PLAY SONG + TRACK STATS ***/
window.playSong = async (filename, url) => {
    const audio = new Audio(url);
    audio.play();

    const statDoc = doc(db, "stats", filename);
    await updateDoc(statDoc, {
        plays: increment(1),
        views: increment(1)
    });

    loadSongs(); // refresh stats
};

/*** ğŸšª LOGOUT (TEMP PLACEHOLDER) ***/
window.logout = () => {
    alert("Logout coming soon ğŸ”");
};

/*** ğŸ”„ RUN ***/
loadSongs();

</script>

</body>
</html>
