<!DOCTYPE html>
<html>
<head>
<title>Artist Profile | Truly Yours DSP</title>

<!-- Fonts + Colors -->
<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');

:root {
  --neon-pink: #ff2bd1;
  --neon-purple: #7a00ff;
  --dark-bg: #050008;
}

body {
  margin: 0;
  font-family: 'Inter', sans-serif;
  background:
    radial-gradient(circle at 20% 10%, #18001f, transparent 40%),
    radial-gradient(circle at 90% 20%, #000014, transparent 40%),
    var(--dark-bg);
  color: white;
  padding: 40px;
  text-align: center;
}

/* Profile container */
.container {
  max-width: 400px;
  margin: auto;
  background: rgba(0,0,0,0.4);
  padding: 25px;
  border-radius: 20px;
  backdrop-filter: blur(6px);
  box-shadow: 0px 0px 15px var(--neon-pink);
}

/* Profile image preview */
#profilePicPreview {
  width: 140px;
  height: 140px;
  border-radius: 50%;
  object-fit: cover;
  border: 3px solid var(--neon-pink);
  margin-bottom: 15px;
}

/* Buttons */
button {
  background: linear-gradient(135deg, var(--neon-purple), var(--neon-pink));
  color: white;
  padding: 12px 20px;
  border: none;
  border-radius: 10px;
  font-weight: 700;
  margin-top: 10px;
  cursor: pointer;
  width: 100%;
}

input, textarea {
  width: 100%;
  padding: 10px;
  margin-top: 10px;
  border-radius: 10px;
  border: none;
}
</style>
</head>

<body>

<h1>ðŸŽ¤ Artist Profile</h1>
<p>Welcome, <span id="artistName"></span> ðŸ‘‹</p>

<div class="container">

  <!-- Profile Picture -->
  <img id="profilePicPreview" src="" alt="Profile Picture">
  <input type="file" id="profilePicFile" accept="image/*">

  <!-- Artist Bio -->
  <textarea id="artistBio" placeholder="Write your bio..."></textarea>

  <button onclick="saveProfile()">Save Profile</button>
  <p id="status"></p>

  <button onclick="window.location.href='dashboard.html'">â¬… Back to Dashboard</button>
  <button onclick="logout()">Logout</button>

</div>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="firebase-init.js"></script>

<script>
const auth = firebase.auth();
const db = firebase.firestore();
const storage = firebase.storage();

let currentUID = null;

/* Load user data when page opens */
auth.onAuthStateChanged(user => {
  if (!user) {
    window.location.href = "login.html";
    return;
  }
  currentUID = user.uid;
  document.getElementById("artistName").innerText = user.email;

  db.collection("artists").doc(currentUID).get().then(doc => {
    if (doc.exists) {
      const data = doc.data();
      if (data.bio) document.getElementById("artistBio").value = data.bio;
      if (data.picURL) document.getElementById("profilePicPreview").src = data.picURL;
    }
  });
});

/* Save Profile Data */
async function saveProfile() {
  const status = document.getElementById("status");
  status.innerText = "Saving...";

  // Save bio
  await db.collection("artists").doc(currentUID).set({
    bio: document.getElementById("artistBio").value
  }, { merge: true });

  // Upload image if selected
  const picFile = document.getElementById("profilePicFile").files[0];
  if (picFile) {
    const ref = storage.ref("artistPics/" + currentUID + ".jpg");
    await ref.put(picFile);
    const downloadURL = await ref.getDownloadURL();

    await db.collection("artists").doc(currentUID).set({ picURL: downloadURL }, { merge: true });

    document.getElementById("profilePicPreview").src = downloadURL;
  }

  status.innerText = "âœ” Profile Updated!";
}

/* Logout */
function logout() {
  auth.signOut();
  window.location.href = "login.html";
}
</script>

</body>
</html>

